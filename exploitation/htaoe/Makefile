CC = gcc
EXEC_STACK = -z execstack					# stack segment EXECUTABLE - allowing shellcode on stack to execute
ABSOLUTE_ADDRESSES = -no-pie				# do not produce ASLR compatible binaries (use absolute addresses)
NO_STACK_PROTECTOR = -fno-stack-protector	# do not add stack canaries before saved return address
NO_MITIGATION_FLAG = ${EXEC_STACK} ${ABSOLUTE_ADDRESSES} ${NO_STACK_PROTECTOR}
CFLAGS = -g  

all: disable_aslr 000_experimental 001_overflow_example 002_auth_overflow 003_auth_overflow2

disable_aslr:
	sudo sh -c 'echo 0 > /proc/sys/kernel/randomize_va_space'

000_experimental: 000_experimental.c
	${CC} ${CFLAGS} ${NO_MITIGATION_FLAG} $< -o $@.elf

001_overflow_example: 001_overflow_example.c
	${CC} ${CFLAGS} ${NO_MITIGATION_FLAG} $< -o $@.elf

002_auth_overflow: 002_auth_overflow.c
	${CC} ${CFLAGS} ${NO_MITIGATION_FLAG} $< -o $@.elf

003_auth_overflow2: 003_auth_overflow2.c
	${CC} ${CFLAGS} ${NO_MITIGATION_FLAG} $< -o $@.elf

clean:
	rm -f *.o *.elf malinput.* core* *.out
