/*
        This code is taken from "Hacking: The Art of Exploitation" by Jon Erickson.
        Few modifications are done to make this code suitable for teaching modern
        binary exploitation on both 32 and 64 bit architectures.

        NOTE to Jon Erickson
        Can't thank you enough for writing this amazing book and sharing your
        perspective in the field of binary exploitation. I'm quite sure the world
        continues to learn from your experience !

TEACHING
hacking execution by writing to a control point - critical variable.

GCC version - gcc (Debian 12.2.0-14) 12.2.0
❯ uname -a
Linux kali 6.1.0-kali5-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.12-1kali2 (2023-02-23) x86_64 GNU/Linux

# Trigger exploitation
> 
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int check_authentication(char *password) {
	/* CONTROL POINT : auth_flag variable */
	int auth_flag = 0;
	char password_buffer[16];
	strcpy(password_buffer, password);
	if(strcmp(password_buffer, "brillig") == 0)
		auth_flag = 1;
	if(strcmp(password_buffer, "outgrabe") == 0)
		auth_flag = 1;
	return auth_flag;
}

int main(int argc, char *argv[]) {
	if(argc < 2) {
		printf("Usage: %s <password>\n", argv[0]);
		exit(0);
	}
	if(check_authentication(argv[1])) {
		printf("\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\n");
		printf("Access Granted.\n");
		printf("-=-=-=-=-=-=-=-=-=-=-=-=-=-\n");
	} else {
		printf("\nAccess Denied.\n");
	}
}
